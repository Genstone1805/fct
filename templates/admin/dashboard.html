<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - First Class Transfer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          sans-serif;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: white;
        padding: 20px 0;
        margin-bottom: 30px;
      }

      header h1 {
        text-align: center;
        font-size: 1.8rem;
        font-weight: 600;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab-btn {
        padding: 12px 24px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .tab-btn:hover {
        border-color: #667eea;
        color: #667eea;
      }

      .tab-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        padding: 30px;
        margin-bottom: 20px;
      }

      .card h2 {
        color: #1a1a2e;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #555;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }

      .alert.show {
        display: block;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .json-input-group {
        margin-bottom: 10px;
      }

      .json-input-group .item-row {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }

      .json-input-group .item-row input {
        flex: 1;
      }

      .json-input-group .remove-btn {
        padding: 8px 12px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      .add-item-btn {
        padding: 8px 16px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #fff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 0.8s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .section-description {
        color: #666;
        margin-bottom: 20px;
        font-size: 0.95rem;
      }

      /* Nested section styles */
      .nested-section {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .nested-section h3 {
        color: #495057;
        font-size: 1.1rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nested-section h3 .badge {
        background: #667eea;
        color: white;
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: normal;
      }

      .nested-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        position: relative;
      }

      .nested-item .remove-nested-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
      }

      .nested-item .form-row {
        margin-bottom: 10px;
      }

      .nested-item .form-group {
        margin-bottom: 10px;
      }

      .add-nested-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 20px;
        background: #17a2b8;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.3s ease;
      }

      .add-nested-btn:hover {
        background: #138496;
      }

      /* Permissions grid styles */
      .permissions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-bottom: 15px;
      }

      .permission-item {
        display: flex;
        flex-direction: column;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #fafafa;
      }

      .permission-item:hover {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .permission-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      .permission-item
        input[type="checkbox"]:checked
        + .permission-label::before {
        background: #667eea;
        border-color: #667eea;
      }

      .permission-item
        input[type="checkbox"]:checked
        + .permission-label::after {
        content: "\2713";
        position: absolute;
        left: 5px;
        top: 1px;
        color: white;
        font-size: 12px;
      }

      .permission-item:has(input:checked) {
        border-color: #667eea;
        background: #f0f4ff;
      }

      .permission-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
        position: relative;
        padding-left: 28px;
      }

      .permission-label::before {
        content: "";
        position: absolute;
        left: 0;
        top: 2px;
        width: 18px;
        height: 18px;
        border: 2px solid #ccc;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .permission-desc {
        font-size: 0.85rem;
        color: #666;
        padding-left: 28px;
      }

      .btn-link {
        background: none;
        border: none;
        color: #667eea;
        cursor: pointer;
        font-size: 0.9rem;
        text-decoration: underline;
        padding: 0;
      }

      .btn-link:hover {
        color: #764ba2;
      }

      .btn-secondary-link {
        display: inline-block;
        padding: 12px 24px;
        background: transparent;
        color: #667eea;
        border: 2px solid #667eea;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-secondary-link:hover {
        background: #667eea;
        color: white;
      }

      .btn-danger {
        padding: 12px 24px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .card {
          padding: 20px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .permissions-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <h1>First Class Transfer - Admin Dashboard</h1>
      </div>
    </header>

    <div class="container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="routes">Create Route</button>
        <button class="tab-btn" data-tab="vehicles">Add Vehicle Option</button>
        <button class="tab-btn" data-tab="faqs">Add FAQ</button>
        <button class="tab-btn" data-tab="admin-users">Admin Users</button>
      </div>

      <!-- Routes Tab -->
      <div id="routes" class="tab-content active">
        <div class="card">
          <h2>Create New Route</h2>
          <p class="section-description">
            Add a new transfer route with all details including pricing,
            content, vehicle options, and FAQs.
          </p>

          <div id="route-alert" class="alert"></div>

          <form id="route-form">
            <div class="form-row">
              <div class="form-group">
                <label for="from_location">From Location *</label>
                <input
                  type="text"
                  id="from_location"
                  name="from_location"
                  required
                  placeholder="e.g., Barcelona Airport"
                />
              </div>
              <div class="form-group">
                <label for="to_location">To Location *</label>
                <input
                  type="text"
                  id="to_location"
                  name="to_location"
                  required
                  placeholder="e.g., Costa Brava"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="meta_title">Meta Title *</label>
                <input
                  type="text"
                  id="meta_title"
                  name="meta_title"
                  required
                  placeholder="SEO Title"
                />
              </div>
              <div class="form-group">
                <label for="hero_title">Hero Title *</label>
                <input
                  type="text"
                  id="hero_title"
                  name="hero_title"
                  required
                  placeholder="Main heading for the page"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="meta_description">Meta Description *</label>
              <textarea
                id="meta_description"
                name="meta_description"
                required
                placeholder="SEO description for search engines"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="sub_headline">Sub Headline *</label>
              <input
                type="text"
                id="sub_headline"
                name="sub_headline"
                required
                placeholder="Supporting text below hero"
              />
            </div>

            <div class="form-group">
              <label for="body">Body Content *</label>
              <textarea
                id="body"
                name="body"
                required
                placeholder="Main content for the route page"
                style="min-height: 150px"
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="distance">Distance *</label>
                <input
                  type="text"
                  id="distance"
                  name="distance"
                  required
                  placeholder="e.g., 120 km"
                />
              </div>
              <div class="form-group">
                <label for="time">Travel Time *</label>
                <input
                  type="text"
                  id="time"
                  name="time"
                  required
                  placeholder="e.g., 1h 30min"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="sedan_price">Sedan Price *</label>
                <input
                  type="number"
                  id="sedan_price"
                  name="sedan_price"
                  required
                  placeholder="e.g., 89"
                />
              </div>
              <div class="form-group">
                <label for="van_price">Van Price *</label>
                <input
                  type="number"
                  id="van_price"
                  name="van_price"
                  required
                  placeholder="e.g., 119"
                />
              </div>
            </div>

            <div class="form-group">
              <label>What Makes Better</label>
              <div id="what_makes_better_list" class="json-input-group">
                <div class="item-row">
                  <input type="text" placeholder="Add feature..." />
                  <button
                    type="button"
                    class="remove-btn"
                    onclick="removeItem(this)"
                  >
                    X
                  </button>
                </div>
              </div>
              <button
                type="button"
                class="add-item-btn"
                onclick="addItem('what_makes_better_list')"
              >
                + Add Item
              </button>
            </div>

            <div class="form-group">
              <label>What's Included *</label>
              <div id="whats_included_list" class="json-input-group">
                <div class="item-row">
                  <input type="text" placeholder="Add included item..." />
                  <button
                    type="button"
                    class="remove-btn"
                    onclick="removeItem(this)"
                  >
                    X
                  </button>
                </div>
              </div>
              <button
                type="button"
                class="add-item-btn"
                onclick="addItem('whats_included_list')"
              >
                + Add Item
              </button>
            </div>

            <div class="form-group">
              <label>Destination Highlights</label>
              <div id="destination_highlights_list" class="json-input-group">
                <div class="item-row">
                  <input type="text" placeholder="Add highlight..." />
                  <button
                    type="button"
                    class="remove-btn"
                    onclick="removeItem(this)"
                  >
                    X
                  </button>
                </div>
              </div>
              <button
                type="button"
                class="add-item-btn"
                onclick="addItem('destination_highlights_list')"
              >
                + Add Item
              </button>
            </div>

            <div class="form-group">
              <label>Ideal For</label>
              <div id="ideal_for_list" class="json-input-group">
                <div class="item-row">
                  <input
                    type="text"
                    placeholder="e.g., Families, Business travelers..."
                  />
                  <button
                    type="button"
                    class="remove-btn"
                    onclick="removeItem(this)"
                  >
                    X
                  </button>
                </div>
              </div>
              <button
                type="button"
                class="add-item-btn"
                onclick="addItem('ideal_for_list')"
              >
                + Add Item
              </button>
            </div>

            <div class="form-group">
              <label for="image">Route Image *</label>
              <input
                type="file"
                id="image"
                name="image"
                accept="image/*"
                required
              />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="book_cta_label">CTA Label *</label>
                <input
                  type="text"
                  id="book_cta_label"
                  name="book_cta_label"
                  required
                  placeholder="e.g., Book Now"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="book_cta_support">CTA Support Text *</label>
              <input
                type="text"
                id="book_cta_support"
                name="book_cta_support"
                required
                placeholder="e.g., Free cancellation up to 24h"
              />
            </div>

            <!-- Vehicle Options Section -->
            <div class="nested-section">
              <h3>
                Vehicle Options
                <span class="badge" id="vehicle-count">0</span>
              </h3>
              <p class="section-description">
                Add vehicle options for this route. You can also add more later
                from the "Add Vehicle Option" tab.
              </p>

              <div id="vehicle_options_container">
                <!-- Vehicle items will be added here -->
              </div>

              <button
                type="button"
                class="add-nested-btn"
                onclick="addVehicleOption()"
              >
                + Add Vehicle Option
              </button>
            </div>

            <!-- FAQs Section -->
            <div class="nested-section">
              <h3>
                FAQs
                <span class="badge" id="faq-count">0</span>
              </h3>
              <p class="section-description">
                Add frequently asked questions for this route. You can also add
                more later from the "Add FAQ" tab.
              </p>

              <div id="faq_container">
                <!-- FAQ items will be added here -->
              </div>

              <button type="button" class="add-nested-btn" onclick="addFAQ()">
                + Add FAQ
              </button>
            </div>

            <button type="submit" class="btn btn-primary" id="route-submit-btn">
              Create Route
            </button>
          </form>
        </div>
      </div>

      <!-- Vehicles Tab -->
      <div id="vehicles" class="tab-content">
        <div class="card">
          <h2>Add Vehicle Option</h2>
          <p class="section-description">
            Add a vehicle option to an existing route. Vehicle options define
            the types of cars available for transfers.
          </p>

          <div id="vehicle-alert" class="alert"></div>

          <form id="vehicle-form">
            <div class="form-group">
              <label for="vehicle_route">Select Route *</label>
              <select id="vehicle_route" name="route" required>
                <option value="">-- Select a Route --</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="vehicle_type">Vehicle Type *</label>
                <select id="vehicle_type" name="vehicle_type" required>
                  <option value="">-- Select Type --</option>
                  <option value="Standard Car">Standard Car</option>
                  <option value="Minivan">Minivan</option>
                </select>
              </div>
              <div class="form-group">
                <label for="max_passengers">Max Passengers *</label>
                <input
                  type="number"
                  id="max_passengers"
                  name="max_passengers"
                  required
                  min="1"
                  placeholder="e.g., 4"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="vehicle_ideal_for">Ideal For *</label>
                <input
                  type="text"
                  id="vehicle_ideal_for"
                  name="ideal_for"
                  required
                  placeholder="e.g., Small groups, couples"
                />
              </div>
              <div class="form-group">
                <label for="fixed_price">Fixed Price *</label>
                <input
                  type="number"
                  id="fixed_price"
                  name="fixed_price"
                  required
                  step="0.01"
                  min="0"
                  placeholder="e.g., 89.00"
                />
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              id="vehicle-submit-btn"
            >
              Add Vehicle Option
            </button>
          </form>
        </div>
      </div>

      <!-- FAQs Tab -->
      <div id="faqs" class="tab-content">
        <div class="card">
          <h2>Add FAQ</h2>
          <p class="section-description">
            Add frequently asked questions to a route. FAQs help customers find
            answers quickly.
          </p>

          <div id="faq-alert" class="alert"></div>

          <form id="faq-form">
            <div class="form-group">
              <label for="faq_route">Select Route *</label>
              <select id="faq_route" name="route" required>
                <option value="">-- Select a Route --</option>
              </select>
            </div>

            <div class="form-group">
              <label for="question">Question *</label>
              <input
                type="text"
                id="question"
                name="question"
                required
                placeholder="e.g., What is the cancellation policy?"
              />
            </div>

            <div class="form-group">
              <label for="answer">Answer *</label>
              <textarea
                id="answer"
                name="answer"
                required
                placeholder="Provide a detailed answer..."
              ></textarea>
            </div>

            <button type="submit" class="btn btn-primary" id="faq-submit-btn">
              Add FAQ
            </button>
          </form>
        </div>
      </div>

      <!-- Admin Users Tab -->
      <div id="admin-users" class="tab-content">
        <div class="card">
          <h2>Create Admin User</h2>
          <p class="section-description">
            Create a new admin user account. A password will be automatically
            generated and sent to their email address.
          </p>

          <div id="admin-alert" class="alert"></div>

          <form id="admin-form" enctype="multipart/form-data">
            <div class="form-row">
              <div class="form-group">
                <label for="admin_full_name">Full Name *</label>
                <input
                  type="text"
                  id="admin_full_name"
                  name="full_name"
                  required
                  placeholder="e.g., John Doe"
                />
              </div>
              <div class="form-group">
                <label for="admin_email">Email Address *</label>
                <input
                  type="email"
                  id="admin_email"
                  name="email"
                  required
                  placeholder="e.g., john@example.com"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="admin_phone">Phone Number</label>
                <input
                  type="tel"
                  id="admin_phone"
                  name="phone_number"
                  placeholder="e.g., +34 600 000 000"
                />
              </div>
              <div class="form-group">
                <label for="admin_dp">Profile Picture</label>
                <input type="file" id="admin_dp" name="dp" accept="image/*" />
              </div>
            </div>

            <div class="form-group">
              <label>Permissions *</label>
              <p class="section-description" style="margin-bottom: 10px">
                Select the permissions this user should have. Users with all
                permissions become administrators.
              </p>
              <div class="permissions-grid">
                <label class="permission-item">
                  <input type="checkbox" name="permissions" value="booking" />
                  <span class="permission-label">Booking Management</span>
                  <span class="permission-desc">View and manage bookings</span>
                </label>
                <label class="permission-item">
                  <input type="checkbox" name="permissions" value="drivers" />
                  <span class="permission-label">Drivers Management</span>
                  <span class="permission-desc">Manage driver accounts</span>
                </label>
                <label class="permission-item">
                  <input type="checkbox" name="permissions" value="routes" />
                  <span class="permission-label">Routes Management</span>
                  <span class="permission-desc">Create and edit routes</span>
                </label>
                <label class="permission-item">
                  <input
                    type="checkbox"
                    name="permissions"
                    value="adminUsers"
                  />
                  <span class="permission-label">Admin Users</span>
                  <span class="permission-desc">Manage admin accounts</span>
                </label>
              </div>
              <button
                type="button"
                class="btn-link"
                onclick="toggleAllPermissions()"
              >
                Select All / Deselect All
              </button>
            </div>

            <button type="submit" class="btn btn-primary" id="admin-submit-btn">
              Create Admin User
            </button>
          </form>
        </div>

        <div class="card" style="margin-top: 20px">
          <h2>Quick Links</h2>
          <p class="section-description">
            Manage your account or sign out of the admin panel.
          </p>
          <div style="display: flex; gap: 15px; flex-wrap: wrap">
            <a href="/password-reset/" class="btn btn-secondary-link"
              >Reset Password</a
            >
            <button type="button" class="btn btn-danger" onclick="logout()">
              Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "/control";
      let vehicleOptionIndex = 0;
      let faqIndex = 0;

      // Tab functionality
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));

          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");
        });
      });

      // Load routes for dropdowns
      async function loadRoutes() {
        try {
          const response = await fetch(`${API_BASE}/routes/`);
          const routes = await response.json();

          const options = routes
            .map(
              (route) =>
                `<option value="${route.id}">${route.fromLocation} â†’ ${route.toLocation}</option>`,
            )
            .join("");

          document.getElementById("vehicle_route").innerHTML =
            '<option value="">-- Select a Route --</option>' + options;
          document.getElementById("faq_route").innerHTML =
            '<option value="">-- Select a Route --</option>' + options;
        } catch (error) {
          console.error("Failed to load routes:", error);
        }
      }

      // Dynamic list management for simple arrays
      function addItem(listId) {
        const list = document.getElementById(listId);
        const newRow = document.createElement("div");
        newRow.className = "item-row";
        newRow.innerHTML = `
                <input type="text" placeholder="Add item...">
                <button type="button" class="remove-btn" onclick="removeItem(this)">X</button>
            `;
        list.appendChild(newRow);
      }

      function removeItem(btn) {
        const list = btn.closest(".json-input-group");
        if (list.querySelectorAll(".item-row").length > 1) {
          btn.closest(".item-row").remove();
        }
      }

      function getListValues(listId) {
        const items = [];
        document
          .querySelectorAll(`#${listId} .item-row input`)
          .forEach((input) => {
            if (input.value.trim()) {
              items.push(input.value.trim());
            }
          });
        return items;
      }

      // Vehicle Options management
      function addVehicleOption() {
        const container = document.getElementById("vehicle_options_container");
        const index = vehicleOptionIndex++;

        const div = document.createElement("div");
        div.className = "nested-item";
        div.id = `vehicle-option-${index}`;
        div.innerHTML = `
                <button type="button" class="remove-nested-btn" onclick="removeVehicleOption(${index})">X</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Vehicle Type *</label>
                        <select class="vo-type" required>
                            <option value="">-- Select Type --</option>
                            <option value="Standard Car">Standard Car</option>
                            <option value="Minivan">Minivan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Max Passengers *</label>
                        <input type="number" class="vo-passengers" min="1" placeholder="e.g., 4" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ideal For *</label>
                        <input type="text" class="vo-ideal" placeholder="e.g., Small groups, couples" required>
                    </div>
                    <div class="form-group">
                        <label>Fixed Price *</label>
                        <input type="number" class="vo-price" step="0.01" min="0" placeholder="e.g., 89.00" required>
                    </div>
                </div>
            `;
        container.appendChild(div);
        updateVehicleCount();
      }

      function removeVehicleOption(index) {
        const item = document.getElementById(`vehicle-option-${index}`);
        if (item) {
          item.remove();
          updateVehicleCount();
        }
      }

      function updateVehicleCount() {
        const count = document.querySelectorAll(
          "#vehicle_options_container .nested-item",
        ).length;
        document.getElementById("vehicle-count").textContent = count;
      }

      function getVehicleOptions() {
        const options = [];
        document
          .querySelectorAll("#vehicle_options_container .nested-item")
          .forEach((item) => {
            const type = item.querySelector(".vo-type").value;
            const passengers = item.querySelector(".vo-passengers").value;
            const ideal = item.querySelector(".vo-ideal").value;
            const price = item.querySelector(".vo-price").value;

            if (type && passengers && ideal && price) {
              options.push({
                vehicle_type: type,
                max_passengers: parseInt(passengers),
                ideal_for: ideal,
                fixed_price: price,
              });
            }
          });
        return options;
      }

      // FAQ management
      function addFAQ() {
        const container = document.getElementById("faq_container");
        const index = faqIndex++;

        const div = document.createElement("div");
        div.className = "nested-item";
        div.id = `faq-item-${index}`;
        div.innerHTML = `
                <button type="button" class="remove-nested-btn" onclick="removeFAQ(${index})">X</button>
                <div class="form-group">
                    <label>Question *</label>
                    <input type="text" class="faq-question" placeholder="e.g., What is the cancellation policy?" required>
                </div>
                <div class="form-group">
                    <label>Answer *</label>
                    <textarea class="faq-answer" placeholder="Provide a detailed answer..." required></textarea>
                </div>
            `;
        container.appendChild(div);
        updateFAQCount();
      }

      function removeFAQ(index) {
        const item = document.getElementById(`faq-item-${index}`);
        if (item) {
          item.remove();
          updateFAQCount();
        }
      }

      function updateFAQCount() {
        const count = document.querySelectorAll(
          "#faq_container .nested-item",
        ).length;
        document.getElementById("faq-count").textContent = count;
      }

      function getFAQs() {
        const faqs = [];
        document
          .querySelectorAll("#faq_container .nested-item")
          .forEach((item) => {
            const question = item.querySelector(".faq-question").value;
            const answer = item.querySelector(".faq-answer").value;

            if (question && answer) {
              faqs.push({
                question: question,
                answer: answer,
              });
            }
          });
        return faqs;
      }

      // Show alert
      function showAlert(elementId, message, isSuccess) {
        const alert = document.getElementById(elementId);
        alert.textContent = message;
        alert.className = `alert show ${isSuccess ? "alert-success" : "alert-error"}`;

        setTimeout(() => {
          alert.classList.remove("show");
        }, 5000);
      }

      // Set loading state
      function setLoading(btnId, isLoading) {
        const btn = document.getElementById(btnId);
        if (isLoading) {
          btn.disabled = true;
          btn.innerHTML = '<span class="loading"></span>Submitting...';
        } else {
          btn.disabled = false;
          btn.textContent = btn.dataset.originalText || "Submit";
        }
      }

      // Store original button text
      document.querySelectorAll(".btn-primary").forEach((btn) => {
        btn.dataset.originalText = btn.textContent;
      });

      // Route form submission
      document
        .getElementById("route-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          setLoading("route-submit-btn", true);

          const formData = new FormData();
          formData.append(
            "from_location",
            document.getElementById("from_location").value,
          );
          formData.append(
            "to_location",
            document.getElementById("to_location").value,
          );
          formData.append(
            "meta_title",
            document.getElementById("meta_title").value,
          );
          formData.append(
            "meta_description",
            document.getElementById("meta_description").value,
          );
          formData.append(
            "hero_title",
            document.getElementById("hero_title").value,
          );
          formData.append(
            "sub_headline",
            document.getElementById("sub_headline").value,
          );
          formData.append("body", document.getElementById("body").value);
          formData.append(
            "distance",
            document.getElementById("distance").value,
          );
          formData.append("time", document.getElementById("time").value);
          formData.append(
            "sedan_price",
            document.getElementById("sedan_price").value,
          );
          formData.append(
            "van_price",
            document.getElementById("van_price").value,
          );
          formData.append(
            "book_cta_label",
            document.getElementById("book_cta_label").value,
          );
          formData.append(
            "book_cta_support",
            document.getElementById("book_cta_support").value,
          );

          // JSON fields
          formData.append(
            "what_makes_better",
            JSON.stringify(getListValues("what_makes_better_list")),
          );
          formData.append(
            "whats_included",
            JSON.stringify(getListValues("whats_included_list")),
          );
          formData.append(
            "destination_highlights",
            JSON.stringify(getListValues("destination_highlights_list")),
          );
          formData.append(
            "ideal_for",
            JSON.stringify(getListValues("ideal_for_list")),
          );

          // Nested vehicle options and FAQs
          formData.append(
            "vehicle_options",
            JSON.stringify(getVehicleOptions()),
          );
          formData.append("faq", JSON.stringify(getFAQs()));

          // Image
          const imageFile = document.getElementById("image").files[0];
          if (imageFile) {
            formData.append("image", imageFile);
          }

          try {
            const response = await fetch(`${API_BASE}/routes/create/`, {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              const result = await response.json();
              const vehicleCount = getVehicleOptions().length;
              const faqCount = getFAQs().length;
              showAlert(
                "route-alert",
                `Route created successfully! Slug: ${result.slug}` +
                  (vehicleCount > 0
                    ? ` | ${vehicleCount} vehicle option(s) added`
                    : "") +
                  (faqCount > 0 ? ` | ${faqCount} FAQ(s) added` : ""),
                true,
              );
              // Clear nested items
              //document.getElementById("route-form").reset();
              //document.getElementById("vehicle_options_container").innerHTML =
              //   "";
              //document.getElementById("faq_container").innerHTML = "";
              //updateVehicleCount();
              //updateFAQCount();
              //loadRoutes();
            } else {
              const error = await response.json();
              showAlert(
                "route-alert",
                `Error: ${JSON.stringify(error)}`,
                false,
              );
            }
          } catch (error) {
            showAlert("route-alert", `Error: ${error.message}`, false);
          }

          setLoading("route-submit-btn", false);
        });

      // Vehicle form submission
      document
        .getElementById("vehicle-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          setLoading("vehicle-submit-btn", true);

          const data = {
            route: parseInt(document.getElementById("vehicle_route").value),
            vehicle_type: document.getElementById("vehicle_type").value,
            max_passengers: parseInt(
              document.getElementById("max_passengers").value,
            ),
            ideal_for: document.getElementById("vehicle_ideal_for").value,
            fixed_price: document.getElementById("fixed_price").value,
          };

          try {
            const response = await fetch(
              `${API_BASE}/vehicle-options/create/`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              },
            );

            if (response.ok) {
              showAlert(
                "vehicle-alert",
                "Vehicle option added successfully!",
                true,
              );
              document.getElementById("vehicle-form").reset();
            } else {
              const error = await response.json();
              showAlert(
                "vehicle-alert",
                `Error: ${JSON.stringify(error)}`,
                false,
              );
            }
          } catch (error) {
            showAlert("vehicle-alert", `Error: ${error.message}`, false);
          }

          setLoading("vehicle-submit-btn", false);
        });

      // FAQ form submission
      document
        .getElementById("faq-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          setLoading("faq-submit-btn", true);

          const data = {
            route: parseInt(document.getElementById("faq_route").value),
            question: document.getElementById("question").value,
            answer: document.getElementById("answer").value,
          };

          try {
            const response = await fetch(`${API_BASE}/faq/create/`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              showAlert("faq-alert", "FAQ added successfully!", true);
              document.getElementById("faq-form").reset();
            } else {
              const error = await response.json();
              showAlert("faq-alert", `Error: ${JSON.stringify(error)}`, false);
            }
          } catch (error) {
            showAlert("faq-alert", `Error: ${error.message}`, false);
          }

          setLoading("faq-submit-btn", false);
        });

      // Toggle all permissions
      function toggleAllPermissions() {
        const checkboxes = document.querySelectorAll(
          '#admin-form input[name="permissions"]',
        );
        const allChecked = Array.from(checkboxes).every((cb) => cb.checked);
        checkboxes.forEach((cb) => (cb.checked = !allChecked));
      }

      // Logout function
      function logout() {
        localStorage.removeItem("accessToken");
        localStorage.removeItem("refreshToken");
        localStorage.removeItem("userPermissions");
        window.location.href = "/template/login/";
      }

      // Admin form submission
      document
        .getElementById("admin-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          setLoading("admin-submit-btn", true);

          const formData = new FormData();
          formData.append(
            "full_name",
            document.getElementById("admin_full_name").value,
          );
          formData.append(
            "email",
            document.getElementById("admin_email").value,
          );

          const phone = document.getElementById("admin_phone").value;
          if (phone) {
            formData.append("phone_number", phone);
          }

          const dpFile = document.getElementById("admin_dp").files[0];
          if (dpFile) {
            formData.append("dp", dpFile);
          }

          // Get selected permissions
          const permissions = [];
          document
            .querySelectorAll('#admin-form input[name="permissions"]:checked')
            .forEach((cb) => {
              permissions.push(cb.value);
            });

          if (permissions.length === 0) {
            showAlert(
              "admin-alert",
              "Please select at least one permission.",
              false,
            );
            setLoading("admin-submit-btn", false);
            return;
          }

          // Append each permission separately for FormData
          permissions.forEach((perm) => {
            formData.append("permissions", perm);
          });

          try {
            const response = await fetch(`/account/signup/`, {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              const result = await response.json();
              showAlert(
                "admin-alert",
                `Admin user created successfully! Login credentials have been sent to ${result.user.email}`,
                true,
              );
              // document.getElementById("admin-form").reset();
            } else {
              const error = await response.json();
              let errorMsg = "Failed to create admin user.";
              if (error.email) {
                errorMsg = `Email: ${error.email[0]}`;
              } else if (typeof error === "object") {
                errorMsg = JSON.stringify(error);
              }
              showAlert("admin-alert", errorMsg, false);
            }
          } catch (error) {
            showAlert("admin-alert", `Error: ${error.message}`, false);
          }

          setLoading("admin-submit-btn", false);
        });

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        loadRoutes();
      });
    </script>
  </body>
</html>
